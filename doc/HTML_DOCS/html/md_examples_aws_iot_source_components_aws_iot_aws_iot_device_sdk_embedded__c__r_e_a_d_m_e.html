<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ESP32 Quick Start Building Blocks: README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="2" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ESP32 Quick Start Building Blocks
   </div>
   <!-- PROJECT BRIEF is expected to be a URL -->
   <div id="projectbrief"><a href=https://github.com/IoTReady/esp32_firmware_base>https://github.com/IoTReady/esp32_firmware_base</a></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_examples_aws_iot_source_components_aws_iot_aws_iot_device_sdk_embedded__c__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://travis-ci.org/aws/aws-iot-device-sdk-embedded-C"><img src="https://travis-ci.org/aws/aws-iot-device-sdk-embedded-C.svg?branch=master" alt="Build Status" style="pointer-events: none;" class="inline"/></a></p>
<p><a href="https://scan.coverity.com/projects/aws-iot-device-sdk-embedded-c"><img src="https://scan.coverity.com/projects/15543/badge.svg" alt="Coverity Scan Build Status" style="pointer-events: none;" class="inline"/> </a></p>
<h2><a class="anchor" id="autotoc_md48"></a>
***** NOTICE *****</h2>
<p>This repository is moving to a new branching system. The master branch will now contain bug fixes/features that have been minimally tested to ensure nothing major is broken. The release branch will contain new releases for the SDK that have been tested thoroughly on all supported platforms. Please ensure that you are tracking the release branch for all production work.</p>
<p>This change will allow us to push out bug fixes quickly and avoid having situations where issues stay open for a very long time.</p>
<h2><a class="anchor" id="autotoc_md49"></a>
Overview</h2>
<p>The AWS IoT device SDK for embedded C is a collection of C source files which can be used in embedded applications to securely connect to the <a href="http://docs.aws.amazon.com/iot/latest/developerguide/what-is-aws-iot.html">AWS IoT platform</a>. It includes transport clients <b>MQTT</b>, <b>TLS</b> implementations and examples for their use. It also supports AWS IoT specific features such as <b>Thing Shadow</b>. It is distributed in source form and intended to be built into customer firmware along with application code, other libraries and RTOS. For additional information about porting the Device SDK for embedded C onto additional platforms please refer to the <a href="https://github.com/aws/aws-iot-device-sdk-embedded-c/blob/master/PortingGuide.md/">PortingGuide</a>.</p>
<h2><a class="anchor" id="autotoc_md50"></a>
Features</h2>
<p>The Device SDK simplifies access to the Pub/Sub functionality of the AWS IoT broker via MQTT and provide APIs to interact with Thing Shadows. The SDK has been tested to work with the AWS IoT platform to ensure best interoperability of a device with the AWS IoT platform.</p>
<h3><a class="anchor" id="autotoc_md51"></a>
MQTT Connection</h3>
<p>The Device SDK provides functionality to create and maintain a mutually authenticated TLS connection over which it runs MQTT. This connection is used for any further publish operations and allow for subscribing to MQTT topics which will call a configurable callback function when these topics are received.</p>
<h3><a class="anchor" id="autotoc_md52"></a>
Thing Shadow</h3>
<p>The Device SDK implements the specific protocol for Thing Shadows to retrieve, update and delete Thing Shadows adhering to the protocol that is implemented to ensure correct versioning and support for client tokens. It abstracts the necessary MQTT topic subscriptions by automatically subscribing to and unsubscribing from the reserved topics as needed for each API call. Inbound state change requests are automatically signalled via a configurable callback.</p>
<h3><a class="anchor" id="autotoc_md53"></a>
Jobs</h3>
<p>The Device SDK implements features to facilitate use of the AWS Jobs service. The Jobs service can be used for device management tasks such as updating program files, rotating device certificates, or running other maintenance tasks such are restoring device settings or restarting devices.</p>
<h2><a class="anchor" id="autotoc_md54"></a>
Design Goals of this SDK</h2>
<p>The embedded C SDK was specifically designed for resource constrained devices (running on micro-controllers and RTOS).</p>
<p>Primary aspects are:</p><ul>
<li>Flexibility in picking and choosing functionality (reduce memory footprint)</li>
<li>Static memory only (no malloc’s)</li>
<li>Configurable resource usage(JSON tokens, MQTT subscription handlers, etc…)</li>
<li>Can be ported to a different RTOS, uses wrappers for OS specific functions</li>
</ul>
<p>For more information on the Architecture of the SDK refer <a href="http://aws-iot-device-sdk-embedded-c-docs.s3-website-us-east-1.amazonaws.com/index.html">here</a></p>
<h2><a class="anchor" id="autotoc_md55"></a>
Collection of Metrics</h2>
<p>Beginning with Release v2.2.0 of the SDK, AWS collects usage metrics indicating which language and version of the SDK is being used. This allows us to prioritize our resources towards addressing issues faster in SDKs that see the most and is an important data point. However, we do understand that not all customers would want to report this data by default. In that case, the sending of usage metrics can be easily disabled by the user by setting the <code>DISABLE_METRICS</code> flag to true in the <code>aws_iot_config.h</code> for each application.</p>
<h2><a class="anchor" id="autotoc_md56"></a>
How to get started ?</h2>
<p>Ensure you understand the AWS IoT platform and create the necessary certificates and policies. For more information on the AWS IoT platform please visit the <a href="http://docs.aws.amazon.com/iot/latest/developerguide/iot-security-identity.html">AWS IoT developer guide</a>.</p>
<p>In order to quickly get started with the AWS IoT platform, we have ported the SDK for POSIX type Operating Systems like Ubuntu, OS X and RHEL. The SDK is configured for the mbedTLS library and can be built out of the box with <em>GCC</em> using <em>make utility</em>. You'll need to download mbedTLS from the official ARMmbed repository. We recommend that you pick the latest version in order to have up-to-date security fixes.</p>
<h2><a class="anchor" id="autotoc_md57"></a>
Installation</h2>
<p>This section explains the individual steps to retrieve the necessary files and be able to build your first application using the AWS IoT device SDK for embedded C.</p>
<p>Steps:</p>
<ul>
<li>Create a directory to hold your application e.g. (/home/&lt;user&gt;/aws_iot/my_app)</li>
<li>Change directory to this new directory</li>
<li>Download the SDK to device and place in the newly created directory</li>
<li>Expand the tarball (tar -xf &lt;tarball.tar&gt;). This will create the below directories:<ul>
<li><code>certs</code> - TLS certificates directory</li>
<li><code>docs</code> - SDK API and file documentation. This folder is not present on GitHub. You can access the documentation <a href="http://aws-iot-device-sdk-embedded-c-docs.s3-website-us-east-1.amazonaws.com/index.html">here</a></li>
<li><code>external_libs</code> - The mbedTLS and jsmn source files</li>
<li><code>include</code> - The AWS IoT SDK header files</li>
<li><code>platform</code> - Platform specific files for timer, TLS and threading layers</li>
<li><code>samples</code> - The sample applications</li>
<li><code>src</code> - The AWS IoT SDK source files</li>
<li><code>tests</code> - Contains tests for verifying that the SDK is functioning as expected. More information can be found <a href="https://github.com/aws/aws-iot-device-sdk-embedded-c/blob/master/tests/README.md">here</a></li>
</ul>
</li>
<li>View further information on how to use the SDK in the Readme file for samples that can be found <a href="https://github.com/aws/aws-iot-device-sdk-embedded-c/blob/master/samples/README.md">here</a></li>
</ul>
<p>Also, for a guided example on getting started with the Thing Shadow, visit the AWS IoT Console's <a href="https://console.aws.amazon.com/iot">Interactive Guide</a>.</p>
<h2><a class="anchor" id="autotoc_md58"></a>
Porting to different platforms</h2>
<p>As Embedded devices run on different Real Time Operating Systems and TCP/IP stacks, it is one of the important design goals for the Device SDK to keep it portable. Please refer to the <a href="https://github.com/aws/aws-iot-device-sdk-embedded-C/blob/master/PortingGuide.md">porting guide</a> to get more information on how to make this SDK run on your devices (i.e. micro-controllers).</p>
<h2><a class="anchor" id="autotoc_md59"></a>
Migrating from 1.x to 2.x</h2>
<p>The 2.x branch makes several changes to the SDK. This section provides information on what changes will be required in the client application for migrating from v1.x to 2.x.</p>
<ul>
<li>The first change is in the folder structure. Client applications using the SDK now need to keep only the certs, external_libs, include, src and platform folder in their application. The folder descriptions can be found above</li>
<li>All the SDK headers are in the <code>include</code> folder. These need to be added to the makefile as include directories</li>
<li>The source files are in the <code>src</code> folder. These need to be added to the makefile as one of the source directories</li>
<li>Similar to 1.x, the platform folder contains the platform specific headers and source files. These need to be added to the makefile as well</li>
<li>The <code>platform/threading</code> folder only needs to be added if multi-threading is required, and the <code>_ENABLE_THREAD_SUPPORT_</code> macro is defined in config</li>
<li>The list below provides a mapping for migrating from the major APIs used in 1.x to the new APIs:</li>
</ul>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Description   </th><th class="markdownTableHeadLeft">1.x   </th><th class="markdownTableHeadLeft">2.x    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Initializing the client   </td><td class="markdownTableBodyLeft"><code>void aws_iot_mqtt_init(MQTTClient_t *pClient);</code>   </td><td class="markdownTableBodyLeft"><code>IoT_Error_t aws_iot_mqtt_init(AWS_IoT_Client *pClient, IoT_Client_Init_Params *pInitParams);</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Connect   </td><td class="markdownTableBodyLeft"><code>IoT_Error_t aws_iot_mqtt_connect(MQTTConnectParams *pParams);</code>   </td><td class="markdownTableBodyLeft"><code>IoT_Error_t aws_iot_mqtt_connect(AWS_IoT_Client *pClient, IoT_Client_Connect_Params *pConnectParams);</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Subscribe   </td><td class="markdownTableBodyLeft"><code>IoT_Error_t aws_iot_mqtt_subscribe(MQTTSubscribeParams *pParams);</code>   </td><td class="markdownTableBodyLeft"><code>IoT_Error_t <a class="el" href="aws__iot__mqtt__client__subscribe_8c.html#a63a694874dbfe4272c658277e5adfcb5" title="Subscribe to an MQTT topic.">aws_iot_mqtt_subscribe(AWS_IoT_Client *pClient, const char *pTopicName, uint16_t topicNameLen, QoS qos, pApplicationHandler_t pApplicationHandler, void *pApplicationHandlerData)</a>;</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Unsubscribe   </td><td class="markdownTableBodyLeft"><code>IoT_Error_t aws_iot_mqtt_unsubscribe(char *pTopic);</code>   </td><td class="markdownTableBodyLeft"><code>IoT_Error_t <a class="el" href="aws__iot__mqtt__client__unsubscribe_8c.html#a12684226331372cb5fbc051235b28913" title="Unsubscribe to an MQTT topic.">aws_iot_mqtt_unsubscribe(AWS_IoT_Client *pClient, const char *pTopicFilter, uint16_t topicFilterLen)</a>;</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Yield   </td><td class="markdownTableBodyLeft"><code>IoT_Error_t aws_iot_mqtt_yield(int timeout);</code>   </td><td class="markdownTableBodyLeft"><code>IoT_Error_t <a class="el" href="aws__iot__mqtt__client__yield_8c.html#a0b638ebb7859f459be2de2fbb7419aa0" title="Yield to the MQTT client.">aws_iot_mqtt_yield(AWS_IoT_Client *pClient, uint32_t timeout_ms)</a>;</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Publish   </td><td class="markdownTableBodyLeft"><code>IoT_Error_t aws_iot_mqtt_publish(MQTTPublishParams *pParams);</code>   </td><td class="markdownTableBodyLeft"><code>IoT_Error_t <a class="el" href="aws__iot__mqtt__client__publish_8c.html#acfbb8ea42852aefdae444f91fdfcd26d" title="Publish an MQTT message on a topic.">aws_iot_mqtt_publish(AWS_IoT_Client *pClient, const char *pTopicName, uint16_t topicNameLen, IoT_Publish_Message_Params *pParams)</a>;</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Disconnect   </td><td class="markdownTableBodyLeft"><code>IoT_Error_t aws_iot_mqtt_disconnect(void);</code>   </td><td class="markdownTableBodyLeft"><code>IoT_Error_t <a class="el" href="aws__iot__mqtt__client__connect_8c.html#ab1b3a65a9d53c0689431d12f4aefbc11" title="Disconnect an MQTT Connection.">aws_iot_mqtt_disconnect(AWS_IoT_Client *pClient)</a>;</code>   </td></tr>
</table>
<p>You can find more information on how to use the new APIs in the Readme file for samples that can be found <a href="https://github.com/aws/aws-iot-device-sdk-embedded-c/blob/master/samples/README.md">here</a></p>
<h2><a class="anchor" id="autotoc_md60"></a>
Migrating from 2.x to 3.x</h2>
<p>AWS IoT Device SDK for Embedded C v3.0.0 fixes two bugs (see #152 and #155) that create a potential buffer overflows. This version is not backward compatible with previous versions, so users will need to recompile their applications with the new version.</p>
<p>Users of AWS IoT Device Shadows or Json utility functions such as <code>extractClientToken</code>, <code>emptyJsonWithClientToken</code>, <code>isJsonValidAndParse</code> and <code>isReceivedJsonValid</code> are encouraged to upgrade to version v3.0.0. For users who cannot upgrade, review all parts of your solution where user input can be sent to the device, and ensure sufficient authorization of these operations is enforced.</p>
<p>Details of the required changes to public functions and data structures are shown below:</p>
<h3><a class="anchor" id="autotoc_md61"></a>
Changes in the &lt;tt&gt;jsonStruct&lt;/tt&gt; data structure:</h3>
<p>The member <code>dataLength</code> has been added to struct <code><a class="el" href="structjson_struct.html" title="This is the struct form of a JSON Key value pair.">jsonStruct</a></code>, which is declared in <a href="include/aws_iot_shadow_json_data.h#L60">include/aws_iot_shadow_json_data.h</a>.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="structjson_struct.html">jsonStruct</a> {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *         <a class="code" href="structjson_struct.html#afddc7c4ad8ec88312dc4c6cb9892b241">pKey</a>;</div>
<div class="line">    <span class="keywordtype">void</span> *               <a class="code" href="structjson_struct.html#aae40f05c7dc64eaa5d6b81c02be6ea06">pData</a>;</div>
<div class="line">    <span class="keywordtype">size_t</span>               <a class="code" href="structjson_struct.html#ad8cb643653f260c9af1bfd748341b384">dataLength</a>;</div>
<div class="line">    <a class="code" href="aws__iot__shadow__json__data_8h.html#a7c784cf859bcccfb415c4df401ea4ab8">JsonPrimitiveType</a>    <a class="code" href="structjson_struct.html#adc471355e69ab39dbe2dbd785d7a2b68">type</a>;</div>
<div class="line">    JsonStructCallback_t <a class="code" href="structjson_struct.html#ac5b597e3581cbde0147ee8b29547fcea">cb</a>;</div>
<div class="line">};</div>
<div class="ttc" id="aaws__iot__shadow__json__data_8h_html_a7c784cf859bcccfb415c4df401ea4ab8"><div class="ttname"><a href="aws__iot__shadow__json__data_8h.html#a7c784cf859bcccfb415c4df401ea4ab8">JsonPrimitiveType</a></div><div class="ttdeci">JsonPrimitiveType</div><div class="ttdoc">All the JSON object types enum.</div><div class="ttdef"><b>Definition:</b> aws_iot_shadow_json_data.h:46</div></div>
<div class="ttc" id="astructjson_struct_html"><div class="ttname"><a href="structjson_struct.html">jsonStruct</a></div><div class="ttdoc">This is the struct form of a JSON Key value pair.</div><div class="ttdef"><b>Definition:</b> aws_iot_shadow_json_data.h:63</div></div>
<div class="ttc" id="astructjson_struct_html_aae40f05c7dc64eaa5d6b81c02be6ea06"><div class="ttname"><a href="structjson_struct.html#aae40f05c7dc64eaa5d6b81c02be6ea06">jsonStruct::pData</a></div><div class="ttdeci">void * pData</div><div class="ttdoc">pointer to the data (JSON value)</div><div class="ttdef"><b>Definition:</b> aws_iot_shadow_json_data.h:65</div></div>
<div class="ttc" id="astructjson_struct_html_ac5b597e3581cbde0147ee8b29547fcea"><div class="ttname"><a href="structjson_struct.html#ac5b597e3581cbde0147ee8b29547fcea">jsonStruct::cb</a></div><div class="ttdeci">jsonStructCallback_t cb</div><div class="ttdoc">callback to be executed on receiving the Key value pair</div><div class="ttdef"><b>Definition:</b> aws_iot_shadow_json_data.h:68</div></div>
<div class="ttc" id="astructjson_struct_html_ad8cb643653f260c9af1bfd748341b384"><div class="ttname"><a href="structjson_struct.html#ad8cb643653f260c9af1bfd748341b384">jsonStruct::dataLength</a></div><div class="ttdeci">size_t dataLength</div><div class="ttdoc">Length (in bytes) of pData.</div><div class="ttdef"><b>Definition:</b> aws_iot_shadow_json_data.h:66</div></div>
<div class="ttc" id="astructjson_struct_html_adc471355e69ab39dbe2dbd785d7a2b68"><div class="ttname"><a href="structjson_struct.html#adc471355e69ab39dbe2dbd785d7a2b68">jsonStruct::type</a></div><div class="ttdeci">JsonPrimitiveType type</div><div class="ttdoc">type of JSON</div><div class="ttdef"><b>Definition:</b> aws_iot_shadow_json_data.h:67</div></div>
<div class="ttc" id="astructjson_struct_html_afddc7c4ad8ec88312dc4c6cb9892b241"><div class="ttname"><a href="structjson_struct.html#afddc7c4ad8ec88312dc4c6cb9892b241">jsonStruct::pKey</a></div><div class="ttdeci">const char * pKey</div><div class="ttdoc">JSON key.</div><div class="ttdef"><b>Definition:</b> aws_iot_shadow_json_data.h:64</div></div>
</div><!-- fragment --><p>The size of the buffer <code>pData</code> must now be specified by <code>dataLength</code>. <b>Failure to do so may result in undefined behavior</b>. Below are examples of the code changes required to use the new <a class="el" href="structjson_struct.html" title="This is the struct form of a JSON Key value pair.">jsonStruct</a>.</p>
<p>With a primitive data type, such as <code>int32_t</code>:</p>
<div class="fragment"><div class="line">…</div>
<div class="line"><a class="code" href="structjson_struct.html">jsonStruct_t</a> exampleJsonStruct;</div>
<div class="line">int32_t value = 0L;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Set the members of exampleJsonStruct. */</span></div>
<div class="line">exampleJsonStruct.<a class="code" href="structjson_struct.html#afddc7c4ad8ec88312dc4c6cb9892b241">pKey</a> = “exampleKey”;</div>
<div class="line">exampleJsonStruct.pData = &amp;value;</div>
<div class="line">exampleJsonStruct.type = <a class="code" href="aws__iot__shadow__json__data_8h.html#a7c784cf859bcccfb415c4df401ea4ab8ad1ba441be7d4dae91d27b86f4aece5d1">SHADOW_JSON_INT32</a>;</div>
<div class="line">exampleJsonStruct.cb = exampleCallback;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Register a delta callback using example JsonStruct. */</span></div>
<div class="line"><a class="code" href="aws__iot__shadow__interface_8h.html#a2b6000e1a7590cff3b6e66601b0c4934">aws_iot_shadow_register_delta</a>(&amp;mqttClient, &amp;exampleJsonStruct); </div>
<div class="line">…</div>
<div class="ttc" id="aaws__iot__shadow__interface_8h_html_a2b6000e1a7590cff3b6e66601b0c4934"><div class="ttname"><a href="aws__iot__shadow__interface_8h.html#a2b6000e1a7590cff3b6e66601b0c4934">aws_iot_shadow_register_delta</a></div><div class="ttdeci">IoT_Error_t aws_iot_shadow_register_delta(AWS_IoT_Client *pClient, jsonStruct_t *pStruct)</div><div class="ttdoc">This function is used to listen on the delta topic of AWS_IOT_MY_THING_NAME mentioned in the aws_iot_...</div><div class="ttdef"><b>Definition:</b> aws_iot_shadow.c:149</div></div>
<div class="ttc" id="aaws__iot__shadow__json__data_8h_html_a7c784cf859bcccfb415c4df401ea4ab8ad1ba441be7d4dae91d27b86f4aece5d1"><div class="ttname"><a href="aws__iot__shadow__json__data_8h.html#a7c784cf859bcccfb415c4df401ea4ab8ad1ba441be7d4dae91d27b86f4aece5d1">SHADOW_JSON_INT32</a></div><div class="ttdeci">@ SHADOW_JSON_INT32</div><div class="ttdef"><b>Definition:</b> aws_iot_shadow_json_data.h:47</div></div>
</div><!-- fragment --><p>Version 3.0.0 will require the following code:</p>
<div class="fragment"><div class="line">…</div>
<div class="line"><a class="code" href="structjson_struct.html">jsonStruct_t</a> exampleJsonStruct;</div>
<div class="line">int32_t value = 0L;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Set the members of exampleJsonStruct. */</span></div>
<div class="line">exampleJsonStruct.<a class="code" href="structjson_struct.html#afddc7c4ad8ec88312dc4c6cb9892b241">pKey</a> = “exampleKey”;</div>
<div class="line">exampleJsonStruct.pData = &amp;value;</div>
<div class="line">exampleJsonStruct.dataLength = <span class="keyword">sizeof</span>(int32_t); <span class="comment">/* sizeof(value) also OK.*/</span></div>
<div class="line">exampleJsonStruct.type = <a class="code" href="aws__iot__shadow__json__data_8h.html#a7c784cf859bcccfb415c4df401ea4ab8ad1ba441be7d4dae91d27b86f4aece5d1">SHADOW_JSON_INT32</a>;</div>
<div class="line">exampleJsonStruct.cb = exampleCallback;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Register a delta callback using example JsonStruct. */</span></div>
<div class="line"><a class="code" href="aws__iot__shadow__interface_8h.html#a2b6000e1a7590cff3b6e66601b0c4934">aws_iot_shadow_register_delta</a>(&amp;mqttClient, &amp;exampleJsonStruct);</div>
<div class="line">…</div>
</div><!-- fragment --><p>With a string, versions up to v2.3.0 would require the following code:</p>
<div class="fragment"><div class="line">…</div>
<div class="line"><a class="code" href="structjson_struct.html">jsonStruct_t</a> exampleJsonStruct;</div>
<div class="line"><span class="keywordtype">char</span> stringBuffer[SIZE_OF_BUFFER];</div>
<div class="line"><span class="comment">/* Set the members of exampleJsonStruct. */</span></div>
<div class="line">exampleJsonStruct.<a class="code" href="structjson_struct.html#afddc7c4ad8ec88312dc4c6cb9892b241">pKey</a> = “exampleKey”;</div>
<div class="line">exampleJsonStruct.pData = stringBuffer;</div>
<div class="line">exampleJsonStruct.type = <a class="code" href="aws__iot__shadow__json__data_8h.html#a7c784cf859bcccfb415c4df401ea4ab8aa60e1987fb123e557c1b38f6adb725e6">SHADOW_JSON_STRING</a>;</div>
<div class="line">exampleJsonStruct.cb = exampleCallback;</div>
<div class="line"><span class="comment">/* Register a delta callback using example JsonStruct. */</span></div>
<div class="line"><a class="code" href="aws__iot__shadow__interface_8h.html#a2b6000e1a7590cff3b6e66601b0c4934">aws_iot_shadow_register_delta</a>(&amp;mqttClient, &amp;exampleJsonStruct);</div>
<div class="line">…</div>
<div class="ttc" id="aaws__iot__shadow__json__data_8h_html_a7c784cf859bcccfb415c4df401ea4ab8aa60e1987fb123e557c1b38f6adb725e6"><div class="ttname"><a href="aws__iot__shadow__json__data_8h.html#a7c784cf859bcccfb415c4df401ea4ab8aa60e1987fb123e557c1b38f6adb725e6">SHADOW_JSON_STRING</a></div><div class="ttdeci">@ SHADOW_JSON_STRING</div><div class="ttdef"><b>Definition:</b> aws_iot_shadow_json_data.h:56</div></div>
</div><!-- fragment --><p>Version 3.0.0 will require the following code:</p>
<div class="fragment"><div class="line">…</div>
<div class="line"><a class="code" href="structjson_struct.html">jsonStruct_t</a> exampleJsonStruct;</div>
<div class="line"><span class="keywordtype">char</span> stringBuffer[SIZE_OF_BUFFER];</div>
<div class="line"><span class="comment">/* Set the members of exampleJsonStruct. */</span></div>
<div class="line">exampleJsonStruct.<a class="code" href="structjson_struct.html#afddc7c4ad8ec88312dc4c6cb9892b241">pKey</a> = “exampleKey”;</div>
<div class="line">exampleJsonStruct.pData = stringBuffer;</div>
<div class="line">exampleJsonStruct.dataLength = SIZE_OF_BUFFER;</div>
<div class="line">exampleJsonStruct.type = <a class="code" href="aws__iot__shadow__json__data_8h.html#a7c784cf859bcccfb415c4df401ea4ab8aa60e1987fb123e557c1b38f6adb725e6">SHADOW_JSON_STRING</a>;</div>
<div class="line">exampleJsonStruct.cb = exampleCallback;</div>
<div class="line"><span class="comment">/* Register a delta callback using example JsonStruct. */</span></div>
<div class="line"><a class="code" href="aws__iot__shadow__interface_8h.html#a2b6000e1a7590cff3b6e66601b0c4934">aws_iot_shadow_register_delta</a>(&amp;mqttClient, &amp;exampleJsonStruct);</div>
<div class="line">…</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md62"></a>
Changes in parseStringValue:</h3>
<p>The function <code>parseStringValue</code>, declared in <a href="include/aws_iot_json_utils.h#L179">include/aws_iot_json_utils.h</a> and implemented in <a href="src/aws_iot_json_utils.c#L184">src/aws_iot_json_utils.c</a>, now requires the inclusion of a buffer length. Its new function signature is:</p>
<div class="fragment"><div class="line"><a class="code" href="aws__iot__error_8h.html#a329da5c3a42979b72561e28e749f6921">IoT_Error_t</a> <a class="code" href="aws__iot__json__utils_8h.html#a434c11c1aec61ca17904ae0dc8b1a1a0">parseStringValue</a>(<span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> bufLen, <span class="keyword">const</span> <span class="keywordtype">char</span> *jsonString, <a class="code" href="structjsmntok__t.html">jsmntok_t</a> *token);</div>
<div class="ttc" id="aaws__iot__error_8h_html_a329da5c3a42979b72561e28e749f6921"><div class="ttname"><a href="aws__iot__error_8h.html#a329da5c3a42979b72561e28e749f6921">IoT_Error_t</a></div><div class="ttdeci">IoT_Error_t</div><div class="ttdoc">IoT Error enum.</div><div class="ttdef"><b>Definition:</b> aws_iot_error.h:40</div></div>
<div class="ttc" id="aaws__iot__json__utils_8h_html_a434c11c1aec61ca17904ae0dc8b1a1a0"><div class="ttname"><a href="aws__iot__json__utils_8h.html#a434c11c1aec61ca17904ae0dc8b1a1a0">parseStringValue</a></div><div class="ttdeci">IoT_Error_t parseStringValue(char *buf, size_t bufLen, const char *jsonString, jsmntok_t *token)</div><div class="ttdoc">Parse a string value from a JSON node.</div><div class="ttdef"><b>Definition:</b> aws_iot_json_utils.c:195</div></div>
<div class="ttc" id="astructjsmntok__t_html"><div class="ttname"><a href="structjsmntok__t.html">jsmntok_t</a></div><div class="ttdef"><b>Definition:</b> jsmn.h:70</div></div>
</div><!-- fragment --><p>Below is an example of code changes required to use the new parseStringValue.</p>
<p>With up to version v2.3.0:</p>
<div class="fragment"><div class="line">…</div>
<div class="line"><span class="keywordtype">char</span>* jsonString = “…”;</div>
<div class="line"><a class="code" href="structjsmntok__t.html">jsmntok_t</a> jsmnTokens[NUMBER_OF_JSMN_TOKENS];</div>
<div class="line"><span class="keywordtype">char</span> stringBuffer[SIZE_OF_BUFFER];</div>
<div class="line"><a class="code" href="aws__iot__json__utils_8h.html#a434c11c1aec61ca17904ae0dc8b1a1a0">parseStringValue</a>(stringBuffer, jsonString, jsmnTokens);</div>
<div class="line">…</div>
</div><!-- fragment --><p>Version 3.0.0 will require the following code:</p>
<div class="fragment"><div class="line">…</div>
<div class="line"><span class="keywordtype">char</span>* jsonString = “…”;</div>
<div class="line"><a class="code" href="structjsmntok__t.html">jsmntok_t</a> jsmnTokens[NUMBER_OF_JSMN_TOKENS];</div>
<div class="line"><span class="keywordtype">char</span> stringBuffer[SIZE_OF_BUFFER];</div>
<div class="line"><a class="code" href="aws__iot__json__utils_8h.html#a434c11c1aec61ca17904ae0dc8b1a1a0">parseStringValue</a>(stringBuffer, SIZE_OF_BUFFER, jsonString, jsmnTokens);</div>
<div class="line">…</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md63"></a>
Changes to functions intended for internal usage:</h3>
<p>Version 3.0.0 changes the signature of four functions intended for internal usage. The new signatures explicitly carry the information for the size of the buffer or JSON document passed as a parameter to the functions. Users of the SDK may need to change their code and recompile to ingest the changes. We report the old and new signatures below.</p>
<h4><a class="anchor" id="autotoc_md64"></a>
Old signatures:</h4>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> <a class="code" href="aws__iot__shadow__json_8h.html#a2d7e5dc24194e4245b477de10f620efb">extractClientToken</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *pJsonDocument, <span class="keywordtype">char</span> *pExtractedClientToken); </div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> emptyJsonWithClientToken(<span class="keywordtype">char</span> *pBuffer);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="aws__iot__shadow__json_8h.html#a525e467f8d32c3ddf4a82809f9f6e0f9">isJsonValidAndParse</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *pJsonDocument, <span class="keywordtype">void</span> *pJsonHandler, int32_t *pTokenCount); </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="aws__iot__shadow__json_8h.html#a6e65aa2600dc65fad96da40c75bf3b43">isReceivedJsonValid</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *pJsonDocument);</div>
<div class="ttc" id="aaws__iot__shadow__json_8h_html_a2d7e5dc24194e4245b477de10f620efb"><div class="ttname"><a href="aws__iot__shadow__json_8h.html#a2d7e5dc24194e4245b477de10f620efb">extractClientToken</a></div><div class="ttdeci">bool extractClientToken(const char *pJsonDocument, size_t jsonSize, char *pExtractedClientToken, size_t clientTokenSize)</div><div class="ttdef"><b>Definition:</b> aws_iot_shadow_json.c:476</div></div>
<div class="ttc" id="aaws__iot__shadow__json_8h_html_a525e467f8d32c3ddf4a82809f9f6e0f9"><div class="ttname"><a href="aws__iot__shadow__json_8h.html#a525e467f8d32c3ddf4a82809f9f6e0f9">isJsonValidAndParse</a></div><div class="ttdeci">bool isJsonValidAndParse(const char *pJsonDocument, size_t jsonSize, void *pJsonHandler, int32_t *pTokenCount)</div><div class="ttdef"><b>Definition:</b> aws_iot_shadow_json.c:379</div></div>
<div class="ttc" id="aaws__iot__shadow__json_8h_html_a6e65aa2600dc65fad96da40c75bf3b43"><div class="ttname"><a href="aws__iot__shadow__json_8h.html#a6e65aa2600dc65fad96da40c75bf3b43">isReceivedJsonValid</a></div><div class="ttdeci">bool isReceivedJsonValid(const char *pJsonDocument, size_t jsonSize)</div><div class="ttdef"><b>Definition:</b> aws_iot_shadow_json.c:455</div></div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md65"></a>
New signatures:</h4>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> <a class="code" href="aws__iot__shadow__json_8h.html#a2d7e5dc24194e4245b477de10f620efb">extractClientToken</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *pJsonDocument, <span class="keywordtype">size_t</span> jsonSize, <span class="keywordtype">char</span> *pExtractedClientToken, <span class="keywordtype">size_t</span> clientTokenSize); </div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> emptyJsonWithClientToken(<span class="keywordtype">char</span> *pBuffer, <span class="keywordtype">size_t</span> bufferSize);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="aws__iot__shadow__json_8h.html#a525e467f8d32c3ddf4a82809f9f6e0f9">isJsonValidAndParse</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *pJsonDocument, <span class="keywordtype">size_t</span> jsonSize, <span class="keywordtype">void</span> *pJsonHandler, int32_t *pTokenCount);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="aws__iot__shadow__json_8h.html#a6e65aa2600dc65fad96da40c75bf3b43">isReceivedJsonValid</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *pJsonDocument, <span class="keywordtype">size_t</span> jsonSize);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md66"></a>
Resources</h2>
<p><a href="http://aws-iot-device-sdk-embedded-c-docs.s3-website-us-east-1.amazonaws.com/index.html">API Documentation</a></p>
<p><a href="http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/csprd02/mqtt-v3.1.1-csprd02.html">MQTT 3.1.1 Spec</a></p>
<h2><a class="anchor" id="autotoc_md67"></a>
Support</h2>
<p>If you have any technical questions about AWS IoT Device SDK, use the <a href="https://forums.aws.amazon.com/forum.jspa?forumID=210">AWS IoT forum</a>. For any other questions on AWS IoT, contact <a href="https://aws.amazon.com/contact-us/">AWS Support</a>.</p>
<h2><a class="anchor" id="autotoc_md68"></a>
Sample APIs</h2>
<p>Connecting to the AWS IoT MQTT platform</p>
<div class="fragment"><div class="line">AWS_IoT_Client client;</div>
<div class="line">rc = aws_iot_mqtt_init(&amp;client, &amp;iotInitParams);</div>
<div class="line">rc = aws_iot_mqtt_connect(&amp;client, &amp;iotConnectParams);</div>
</div><!-- fragment --><p>Subscribe to a topic</p>
<div class="fragment"><div class="line">AWS_IoT_Client client;</div>
<div class="line">rc = aws_iot_mqtt_subscribe(&amp;client, &quot;sdkTest/sub&quot;, 11, QOS0, iot_subscribe_callback_handler, NULL);</div>
</div><!-- fragment --><p>Update Thing Shadow from a device</p>
<div class="fragment"><div class="line">rc = aws_iot_shadow_update(&amp;mqttClient, AWS_IOT_MY_THING_NAME, pJsonDocumentBuffer, ShadowUpdateStatusCallback,</div>
<div class="line">                            pCallbackContext, TIMEOUT_4SEC, persistenSubscription);</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://iotready.co"> IoTReady </a><img class="footer" src="logo.png" width="30" height="30" alt="IoTReady"/></a></li>
  </ul>
</div>
</body>
</html>
